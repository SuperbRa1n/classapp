{"version":3,"file":"index.js","sources":["pages/index/index.vue","pages/index/index.vue?type=page"],"sourcesContent":["<template>\n\t<view class=\"container\">\n\t  <image src=\"https://tannin-1316822731.cos.ap-nanjing.myqcloud.com/2024-07-06-%E5%9B%BE%E7%89%871.png\" class=\"logo\" />\n\t  <text class=\"title\">登录界面</text>\n\t  <input \n\t\tclass=\"input\" \n\t\tplaceholder=\"学号\" \n\t\tv-model=\"username\" \n\t  />\n\t  <input \n\t\tclass=\"input\" \n\t\tplaceholder=\"学校通行证密码\" \n\t\tv-model=\"password\" \n\t\tpassword \n\t  />\n\t  <view class=\"checkbox-container\">\n\t\t<view class=\"checkbox\" @tap=\"toggleCheckbox\">\n\t\t  <view v-if=\"checked\" class=\"checked-box\"></view>\n\t\t</view>\n\t\t<text>同意 免责声明、隐私政策等服务条款</text>\n\t  </view>\n\t  <button \n\t\tclass=\"button\" \n\t\t@tap=\"handleLoginPress\" \n\t\t:disabled=\"isLoading\"\n\t  >\n\t\t<block v-if=\"isLoading\">\n\t\t  <text>登录中...</text>\n\t\t</block>\n\t\t<block v-else>\n\t\t  <text>登录</text>\n\t\t</block>\n\t  </button>\n\t  <view>\n\t\t<text>{{ message }}</text>\n\t  </view>\n\t</view>\n  </template>\n  \n  <script>\n  import { getClassInfo, getGradeInfo, getUserInfo, BASE_URL, LOGIN } from '@/utils/api.js';\n  \n  export default {\n\tdata() {\n\t  return {\n\t\tusername: '',\n\t\tpassword: '',\n\t\tchecked: false,\n\t\tisLoading: false,\n\t\tmessage: '',\n\t  };\n\t},\n\tmethods: {\n\t  toggleCheckbox() {\n\t\tthis.checked = !this.checked;\n\t  },\n\t  async handleLoginPress() {\n\t\tif (!this.checked) {\n\t\t  uni.showToast({\n\t\t\ttitle: '请先同意服务条款',\n\t\t\ticon: 'none',\n\t\t  });\n\t\t  return;\n\t\t}\n\t\tthis.isLoading = true;\n\t\tthis.message = '正在登录……';\n  \n\t\tconst data = {\n\t\t  username: this.username,\n      password: this.password,\n\t\t};\n  \n\t\ttry {\n      console.log('data', data)\n\t\t  const res = await uni.request({\n\t\t\turl: BASE_URL + LOGIN,\n\t\t\tmethod: 'POST',\n\t\t\tdata,\n\t\t\theader: {\n        'Access-Control-Allow-Origin': '*',\n        'Content-Type': 'application/x-www-form-urlencoded',\n\t\t\t},\n\t\t  });\n  \n\t\t  if (res.data?.status === '登录成功') {\n\t\t\tthis.message = '登录成功，正在获取课程和成绩信息，请耐心等待……';\n  \n\t\t\t// 存储用户名和密码\n\t\t\tuni.setStorageSync('username', this.username);\n\t\t\tuni.setStorageSync('password', this.password);\n  \n\t\t\tconst JSESSIONID = res.data.JSESSIONID;\n  \n\t\t\t// 获取用户信息、课程信息和成绩信息\n\t\t\tconst userInfo = await getUserInfo(JSESSIONID);\n\t\t\tuni.setStorageSync('userInfo', userInfo);\n  \n\t\t\tconst classInfo = await getClassInfo(JSESSIONID);\n\t\t\tuni.setStorageSync('classInfo', classInfo);\n  \n\t\t\tconst gradeInfo = await getGradeInfo(JSESSIONID);\n\t\t\tuni.setStorageSync('gradeInfo', gradeInfo);\n  \n\t\t\tthis.isLoading = false;\n\t\t  } else {\n\t\t\t// 登录失败处理\n\t\t\tuni.showModal({\n\t\t\t  title: '登录失败',\n\t\t\t  content: res.data?.status || '未知错误',\n\t\t\t  showCancel: false,\n\t\t\t});\n\t\t\tthis.isLoading = false;\n\t\t  }\n\t\t} catch (error) {\n\t\t  console.error('登录出错:', error);\n\t\t  uni.showToast({\n\t\t\ttitle: '登录失败，请稍后重试',\n\t\t\ticon: 'none',\n\t\t  });\n\t\t  this.isLoading = false;\n\t\t}\n\t  },\n\t},\n  };\n  </script>\n  \n  <style>\n  .container {\n\tdisplay: flex;\n\tflex-direction: column;\n\talign-items: center;\n\tjustify-content: center;\n\tpadding: 20px;\n\tbackground-color: #fff;\n\theight: 100vh;\n  }\n  .logo {\n\twidth: 100%;\n\theight: 100px;\n\tmargin-bottom: 20px;\n  }\n  .title {\n\tfont-size: 20px;\n\tmargin-bottom: 20px;\n  }\n  .input {\n\twidth: 100%;\n\tpadding: 10px;\n\tmargin-bottom: 20px;\n\tborder: 1px solid #ccc;\n\tborder-radius: 5px;\n  }\n  .checkbox-container {\n\tdisplay: flex;\n\talign-items: center;\n\tmargin-bottom: 20px;\n  }\n  .checkbox {\n\twidth: 20px;\n\theight: 20px;\n\tborder: 1px solid #ccc;\n\tmargin-right: 10px;\n\tjustify-content: center;\n\talign-items: center;\n  }\n  .checked-box {\n\twidth: 14px;\n\theight: 14px;\n\tbackground-color: #000;\n  }\n  .button {\n\tbackground-color: #007BFF;\n\tcolor: #fff;\n\tpadding: 10px 20px;\n\tborder-radius: 5px;\n\ttext-align: center;\n\tmargin-bottom: 20px;\n  }\n  </style>\n  ","import MiniProgramPage from '/Users/tanninrachel/Documents/code/classapp/pages/index/index.vue'\nwx.createPage(MiniProgramPage)"],"names":["uni","BASE_URL","LOGIN","getUserInfo","getClassInfo","getGradeInfo"],"mappings":";;;AA0CE,MAAK,YAAU;AAAA,EAChB,OAAO;AACL,WAAO;AAAA,MACR,UAAU;AAAA,MACV,UAAU;AAAA,MACV,SAAS;AAAA,MACT,WAAW;AAAA,MACX,SAAS;AAAA;EAET;AAAA,EACD,SAAS;AAAA,IACP,iBAAiB;AAClB,WAAK,UAAU,CAAC,KAAK;AAAA,IACnB;AAAA,IACD,MAAM,mBAAmB;;AAC1B,UAAI,CAAC,KAAK,SAAS;AACjBA,sBAAAA,MAAI,UAAU;AAAA,UACf,OAAO;AAAA,UACP,MAAM;AAAA,QACL,CAAC;AACD;AAAA,MACF;AACA,WAAK,YAAY;AACjB,WAAK,UAAU;AAEf,YAAM,OAAO;AAAA,QACX,UAAU,KAAK;AAAA,QACb,UAAU,KAAK;AAAA;AAGnB,UAAI;AACAA,sBAAAA,MAAA,MAAA,OAAA,+BAAY,QAAQ,IAAI;AAC1B,cAAM,MAAM,MAAMA,cAAG,MAAC,QAAQ;AAAA,UAC/B,KAAKC,qBAAWC,UAAK;AAAA,UACrB,QAAQ;AAAA,UACR;AAAA,UACA,QAAQ;AAAA,YACH,+BAA+B;AAAA,YAC/B,gBAAgB;AAAA,UACpB;AAAA,QACA,CAAC;AAED,cAAI,SAAI,SAAJ,mBAAU,YAAW,QAAQ;AAClC,eAAK,UAAU;AAGfF,wBAAAA,MAAI,eAAe,YAAY,KAAK,QAAQ;AAC5CA,wBAAAA,MAAI,eAAe,YAAY,KAAK,QAAQ;AAE5C,gBAAM,aAAa,IAAI,KAAK;AAG5B,gBAAM,WAAW,MAAMG,sBAAY,UAAU;AAC7CH,wBAAAA,MAAI,eAAe,YAAY,QAAQ;AAEvC,gBAAM,YAAY,MAAMI,uBAAa,UAAU;AAC/CJ,wBAAAA,MAAI,eAAe,aAAa,SAAS;AAEzC,gBAAM,YAAY,MAAMK,uBAAa,UAAU;AAC/CL,wBAAAA,MAAI,eAAe,aAAa,SAAS;AAEzC,eAAK,YAAY;AAAA,eACT;AAERA,wBAAAA,MAAI,UAAU;AAAA,YACZ,OAAO;AAAA,YACP,WAAS,SAAI,SAAJ,mBAAU,WAAU;AAAA,YAC7B,YAAY;AAAA,UACd,CAAC;AACD,eAAK,YAAY;AAAA,QAChB;AAAA,MACA,SAAO,OAAO;AACdA,2EAAc,SAAS,KAAK;AAC5BA,sBAAAA,MAAI,UAAU;AAAA,UACf,OAAO;AAAA,UACP,MAAM;AAAA,QACL,CAAC;AACD,aAAK,YAAY;AAAA,MACnB;AAAA,IACE;AAAA,EACF;;;;;;;;;;;;;;;;;;;ACzHF,GAAG,WAAW,eAAe;"}